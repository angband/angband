name: Linux

on:
  push:
    branches: [ master ]
  pull_request:

jobs:
  tests:
    name: Tests
    runs-on: ubuntu-latest
    container:
      image: archlinux
    steps:
      # Force a system update (u added to -Sy) because had problems with the
      # clone step failing because the system libc lacked a symbol needed by
      # docker.
      - name: Install Build Dependencies
        run: pacman -Syu gcc automake autoconf make libx11 --noconfirm

      - name: Clone Project
        uses: actions/checkout@v2

      - name: Build
        run: |
          ./autogen.sh
          ./configure --with-no-install --enable-test
          make
          make tests
          ./run-tests

  x11:
    name: X11
    runs-on: ubuntu-latest
    container:
      image: archlinux
    steps:
      # See above comment for why a system update is forced.
      - name: Install Build Dependencies
        run: pacman -Syu gcc make cmake libx11 --noconfirm

      - name: Clone Project
        uses: actions/checkout@v2

      - name: Build
        run: |
          mkdir build
          cd build
          cmake ..
          make

  ncurses:
    name: NCurses
    runs-on: ubuntu-latest
    container:
      image: archlinux
    steps:
      # See above comment for why a system update is forced.
      - name: Install Build Dependencies
        run: pacman -Syu gcc make cmake ncurses --noconfirm

      - name: Clone Project
        uses: actions/checkout@v2

      - name: Build
        run: |
          mkdir build
          cd build
          cmake -DSUPPORT_NCURSES_FRONTEND=ON ..
          make

  sdl:
    name: SDL
    runs-on: ubuntu-latest
    container:
      image: archlinux
    steps:
      # See above comment for why a system update is forced.
      - name: Install Build Dependencies
        run: pacman -Syu gcc make cmake sdl_image sdl_ttf --noconfirm

      - name: Clone Project
        uses: actions/checkout@v2

      - name: Build
        run: |
          mkdir build
          cd build
          cmake -DSUPPORT_SDL_FRONTEND=ON ..
          make
