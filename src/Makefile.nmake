# Windows Angband makefile for NMAKE and MS Visual C
#
# Debug build:   NMAKE /F Makefile.nmake
# Release build: NMAKE /F Makefile.nmake RELEASE=1


EXE = Angband.exe
default: ..\$(EXE)
exe: $(EXE)


# tools and config
CC = cl
LINK = link
RC = rc
CFLAGS = /DWINDOWS /W3 /GF /GA /nologo /D_CRT_SECURE_NO_WARNINGS
LFLAGS = /nologo
RCFLAGS =
LIBS = Gdi32.lib User32.lib Comdlg32.lib Shell32.lib Winmm.lib Msimg32.lib win/lib/libpng.lib win/lib/zlib.lib

!if defined(RELEASE)
CFLAGS = $(CFLAGS) /O2 /Os /Gs /I. /I..
!else
CFLAGS = $(CFLAGS) /Od /Zi /I. /I..
LFLAGS = $(LFLAGS) /debug
!endif


# files
include Makefile.src
OBJS = $(ANGFILES) $(ZFILES) $(WINMAINFILES)
RES = win\angband.res


# rules
.c.o:
	$(CC) /c /Fo$@ $(CFLAGS) $?

$(RES) : win\angband.rc
	$(RC) $(RCFLAGS) $**

$(EXE) : $(OBJS) $(RES)
	$(LINK) /out:$@ $(LFLAGS) $** $(LIBS)

..\$(EXE) : $(EXE)
	copy $** $@

clean:
	del $(OBJS) $(RES) $(EXE)
